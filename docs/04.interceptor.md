---
title: カスタムのインターセプタを HAPI JPA Server に組み込む
tags:
  - hapi
  - fhir
private: false
updated_at: '2024-07-06T18:00:00+09:00'
id: null
organization_url_name: null
slide: false
ignorePublish: false
---

次はカスタムのインターセプタを HAPI JPA Server に組み込んでみます。

# インターセプタとは

HAPI がデータの登録など、何かをしようとした時に実行されるのがインターセプタということらしいです。

<https://hapifhir.io/hapi-fhir/docs/interceptors/interceptors.html>

HAPI FHIR 3.8.0 から新しいフレームワークが導入されたらしく、クライアントとサーバーどちらでも使うことができ、柔軟にイベント処理のようなものを追加することができるとありました。

# カスタムのインターセプタクラスを作成する

以下ドキュメントを見る限りでは、カスタムインターセプタを含むパッケージとクラス名を設定に追加して読み込ませるようです。

<https://github.com/hapifhir/hapi-fhir-jpaserver-starter>

ではカスタムのインターセプタを定義するための Maven プロジェクトを作っていきます。

## Java 開発環境

[IntelliJ IDEA](https://www.jetbrains.com/idea/) を使って作るのが一般的なのだと思うのですが、ここでそれをインストールして使うのも面倒なので、ここでは [sdkman](https://sdkman.io/) を使ってサクッと Java + Maven の開発環境を整えました。

インストール方法などは詳しく説明しませんが、以下のページにやり方が書いてあります。

* インストール方法 : <https://sdkman.io/install>
* 使い方 : <https://sdkman.io/usage>

以下のような環境でやっていきます。

```text
$ sdk version

SDKMAN!
script: 5.18.2
native: 0.4.3

$ sdk current

Using:

java: 21.0.1-open
maven: 3.9.5
```

## プロジェクトの作成

以下のような Maven コマンドでプロジェクトを作成します。

```bash
mvn archetype:generate \
  -DarchetypeArtifactId=maven-archetype-quickstart \
  -DinteractiveMode=false \
  -DgroupId=com.example.fhir.hapi \
  -DartifactId=my-interceptors
```

すると `my-interceptors` というディレクトリが作成されて、その中に Maven プロジェクトが作成されます。不要なファイルが Git 管理されないよう Maven でよく使用される [gitignore](https://github.com/github/gitignore/blob/main/Maven.gitignore) の設定をダウンロードしてきて `my-interceptors` 内にあらかじめ置いておきましょう。
